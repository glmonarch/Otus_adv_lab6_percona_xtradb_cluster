### Описание стенда

Данный стенд демонстрирует технологию построения отказоустойчивого сайта Wordpress с применением кластера СУБД Percona XtraDB Cluster, маршрутизатора SQL запросов ProxySQL, а также кластера Keepalived. Стенд тестировался на Mac OS 10.15.7 со следующим установленным ПО:

1. VirtualBox 6.1.18 r142142 (Qt5.6.3)
2. Vagrant 2.2.14
3. Ansible 2.10.5
4. Python 2.7.16

После развертывания стенда будет создано 6 ВМ:

1. **db1 [10.0.0.13]** - 1-я нода Percona кластера. 
2. **db2 [10.0.0.14]** - 2-я нода Percona кластера. 
3. **db3 [10.0.0.15]** - 3-я нода Percona кластера.
4. **dbproxy [10.0.0.20]** - машина с ProxySQL, которая является единой точкой входа в базу данных.
5. **node1 [192.168.100.11, 10.0.0.11]** - фронтэнд-1. ВМ Centos 7 с Nginx, php-fpm и keepalived. 
6. **node2 [192.168.100.12, 10.0.0.12]** - фронтэнд-2. ВМ Centos 7 с Nginx, php-fpm и keepalived.

Между машинами node1 и node2 подвешен плавающий VRRP_IP 192.168.100.100 По умолчанию VRRP_IP 192.168.100.100 висит на машине node1.


***Цель лабораторной работы: продемонстрировать доступность сайта Wordpress с хост-машины по адресу http://192.168.100.100 после того как станет недоступна одна из машин фронтэнда и одна из нод Percona кластера.***



Сети 192.168.100.0/24 и 10.0.0.0/24, созданные в рамках VirtualBox являются "private_network" и доступны с хост-машины на которой разворачивается стенд. Каждая машина создается с RAM 256Gb на борту.

### Как поднять стенд?

1. **git clone** https://github.com/glmonarch/Otus_adv_lab6_percona_xtradb_cluster.git
2. **cd Otus_adv_lab6_percona_xtradb_cluster**
3. **vagrant up**
4. **ansible-playbook site.yml**

### Как проверить отказоустойчивость?
1. Зайти с хост-машины через браузер по адресу http://192.168.100.100
2. Заполнить 4 поля начальной регистрации Wordpress и нажать внизу кнопку "Install Wordpress"
3. Зайти в панель управления Wordpress
4. Подключиться по ssh к node1: **vagrant ssh node1** и, например, выключить эту ВМ: **shutdown -h now**
5. Обновить страницу http://192.168.100.100 на хост-машине и убедиться, что Wordpress по прежнему доступен.
6. Далее, можно уничтожить, например, одну из нод Percona кластера, выполнив команду **vagrant destroy db1 -f**
7. Обновить страницу http://192.168.100.100 на хост-машине и убедиться, что Wordpress по прежнему доступен.   
